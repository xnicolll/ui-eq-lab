{% extends "base.html" %}

{% block content %}
<div class="content-section quiz-page">
    <div class="quiz-container">
        <div class="quiz-header">
            <h3>{{ question.question }}</h3>
        </div>

        <div class="quiz-content">
            <div class="audio-comparison">
                <div class="audio-section">
                    <h4>Before</h4>
                    <div class="play-button" data-audio="{{ question.audio.before }}">
                        <div class="play-icon"></div>
                    </div>
                </div>

                <div class="audio-section">
                    <h4>Processed</h4>
                    <div class="play-button" data-audio="{{ question.audio.after }}">
                        <div class="play-icon"></div>
                    </div>
                </div>
            </div>

            <div class="options">
                {% for option in question.options %}
                <label class="option">
                    <input type="radio" name="q{{ question.id }}" value="{{ option.lower().replace(' ', '-') }}">
                    <span>{{ option }}</span>
                </label>
                {% endfor %}
            </div>

            <div class="navigation-controls">
                {% if question.id > 1 %}
                <a href="{{ url_for('quiz_specific', question_id=question.id-1) }}" class="nav-btn prev-btn">Previous</a>
                {% endif %}
                <button class="nav-btn next-btn" disabled>Next</button>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const playButtons = document.querySelectorAll('.play-button');
    let currentAudio = null;

    // Handle play button clicks
    playButtons.forEach(button => {
        const audioUrl = button.dataset.audio;
        const audio = new Audio(audioUrl);
        
        button.addEventListener('click', function() {
            if (currentAudio && currentAudio !== audio) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
                currentAudio.playButton.classList.remove('playing');
            }
            
            if (audio.paused) {
                audio.play();
                button.classList.add('playing');
                currentAudio = audio;
                currentAudio.playButton = button;
            } else {
                audio.pause();
                audio.currentTime = 0;
                button.classList.remove('playing');
                currentAudio = null;
            }
        });

        // Add ended event listener
        audio.addEventListener('ended', function() {
            button.classList.remove('playing');
            currentAudio = null;
        });
    });

    // Handle answer selection
    const options = document.querySelectorAll('.option input');
    const nextButton = document.querySelector('.next-btn');
    
    options.forEach(option => {
        option.addEventListener('change', function() {
            nextButton.disabled = false;
        });
    });

    // Handle navigation
    nextButton.addEventListener('click', function() {
        const selectedAnswer = document.querySelector(`input[name="q{{ question.id }}"]:checked`);
        if (selectedAnswer && selectedAnswer.value === '{{ question.correct_answer }}') {
            // Correct answer
            window.location.href = '{{ url_for("quiz_specific", question_id=question.id+1) }}';
        } else {
            // Wrong answer
            alert('Try again!');
        }
    });
});
</script>
{% endblock %}

<!-- Question 2 Template -->
{% if question_number == 2 %}
<div class="content-section quiz-page">
    <div class="quiz-container">
        <div class="quiz-header">
            <h3>What technique has been applied?</h3>
        </div>

        <div class="quiz-content">
            <div class="audio-comparison">
                <div class="audio-section">
                    <h4>Before</h4>
                    <div class="play-button" data-audio="/static/audio/tylerthecreator_normal.mp3">
                        <div class="play-icon"></div>
                    </div>
                </div>

                <div class="audio-section">
                    <h4>Processed</h4>
                    <div class="play-button" data-audio="/static/audio/tylerthecreator_hipass.mp3">
                        <div class="play-icon"></div>
                    </div>
                </div>
            </div>

            <div class="options">
                <label class="option">
                    <input type="radio" name="q2" value="high-pass">
                    <span>High Pass</span>
                </label>
                <label class="option">
                    <input type="radio" name="q2" value="low-pass">
                    <span>Low Pass</span>
                </label>
            </div>

            <div class="navigation-controls">
                <button class="nav-btn prev-btn">Previous</button>
                <button class="nav-btn next-btn">Next</button>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const playButtons = document.querySelectorAll('.play-button');
    let currentAudio = null;

    // Handle play button clicks
    playButtons.forEach(button => {
        const audioUrl = button.dataset.audio;
        const audio = new Audio(audioUrl);
        
        button.addEventListener('click', function() {
            if (currentAudio && currentAudio !== audio) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
                currentAudio.playButton.classList.remove('playing');
            }
            
            if (audio.paused) {
                audio.play();
                button.classList.add('playing');
                currentAudio = audio;
                currentAudio.playButton = button;
            } else {
                audio.pause();
                audio.currentTime = 0;
                button.classList.remove('playing');
                currentAudio = null;
            }
        });

        // Add ended event listener
        audio.addEventListener('ended', function() {
            button.classList.remove('playing');
            currentAudio = null;
        });
    });

    // Handle answer selection
    const options = document.querySelectorAll('.option input');
    const nextButton = document.querySelector('.next-btn');
    
    options.forEach(option => {
        option.addEventListener('change', function() {
            nextButton.disabled = false;
        });
    });

    // Handle navigation
    nextButton.addEventListener('click', function() {
        const selectedAnswer = document.querySelector('input[name="q2"]:checked');
        if (selectedAnswer && selectedAnswer.value === 'high-pass') {
            // Correct answer
            window.location.href = '/quiz/3';  // Navigate to next question
        } else {
            // Wrong answer
            alert('Try again!');
        }
    });
});
</script>
{% endif %} 